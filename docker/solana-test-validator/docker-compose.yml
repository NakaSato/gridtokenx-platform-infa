services:
  solana-test-validator:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        SOLANA_VERSION: "1.18.22"
    container_name: solana-test-validator
    ports:
      - "8899:8899" # JSON RPC
      - "8900:8900" # WebSocket
      - "9900:9900" # Faucet
    volumes:
      - solana-ledger:/solana/ledger
    environment:
      - RUST_LOG=solana_runtime::system_instruction_processor=trace,solana_runtime::message_processor=debug,solana_bpf_loader=debug,solana_rbpf=debug
    ulimits:
      nofile:
        soft: 1000000
        hard: 1000000
    healthcheck:
      test: [ "CMD", "solana", "cluster-version", "--url", "http://localhost:8899" ]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    restart: unless-stopped
    networks:
      - gridtokenx-network

volumes:
  solana-ledger:
    driver: local

networks:
  gridtokenx-network:
    external: true
