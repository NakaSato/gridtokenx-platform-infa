@startuml
!include <C4/C4_Container>
!include <tupadr3/devicons/python>
!include <tupadr3/devicons/postgresql>
!include <tupadr3/font-awesome-5/server>
!include <tupadr3/font-awesome-5/bolt>

title **Data & Simulator Layer - telemetry & Persistence**

Container(simulator, "Smart Meter Sim", "Python / FastAPI", "Generates high-fidelity simulated grid telemetry and prosumer data.", $sprite="python")

System_Boundary(data_infrastructure, "Data & Streaming Tier") {
    ContainerQueue(kafka, "Kafka Cluster", "Event Stream", "High-throughput telemetry ingestion pipeline.", $sprite="server")
    ContainerDb(influx, "InfluxDB", "Time-Series", "Granular production metrics for analytics.", $sprite="bolt")
    ContainerDb(postgres, "PostgreSQL", "Relational", "Configuration and persistent prosumer state.", $sprite="postgresql")
}

Container(api_gateway, "API Gateway", "Rust", "Consumer of processed grid data and controller.")

' Data Flows
Rel(simulator, kafka, "Emit Readings", "Kafka Protocol")
Rel(simulator, influx, "Write Metrics", "Line Protocol")
Rel(simulator, postgres, "Persist Config", "SQL (psycopg2)")

' Control & Consumption
Rel(api_gateway, simulator, "Control Simulation", "HTTP (REST)")
Rel(api_gateway, kafka, "Consume Telemetry", "Kafka Protocol (rdkafka)")

footer GridTokenX v2.0 | Data & Simulator Architecture | 2026
@enduml
