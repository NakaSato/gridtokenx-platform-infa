@startuml
!include <C4/C4_Container>
!include <tupadr3/devicons/react>
!include <tupadr3/devicons/python>
!include <tupadr3/devicons/rust>
!include <tupadr3/devicons/postgresql>
!include <tupadr3/devicons/redis>
!include <tupadr3/font-awesome-5/coins>
!include <tupadr3/font-awesome-5/user>

' Visual Configuration
skinparam defaultFontName "Helvetica Neue"
skinparam defaultFontSize 14
skinparam roundCorner 8
skinparam shadowing false
skinparam handwritten false
skinparam backgroundColor #FFFFFF

' C4 Options
SHOW_PERSON_OUTLINE()
LAYOUT_WITH_LEGEND()

title System Container Diagram for GridTokenX Platform

Person(user, "User/Prosumer", "A user who trades energy credits or manages their smart meter.", $sprite="user")

System_Boundary(c1, "GridTokenX Platform") {
    Container(frontend, "Trading Frontend", "Next.js, React", "Provides the web interface for trading and dashboard.", $sprite="react")
    Container(gateway, "API Gateway", "Rust, Axum", "Handles API requests, authentication, and business logic.", $sprite="rust")
    Container(simulator, "Smart Meter Simulator", "Python", "Simulates smart meter energy readings.", $sprite="python")
    
    ContainerDb(db, "Database", "PostgreSQL", "Stores user data, meter readings, and transaction history.", $sprite="postgresql")
    ContainerDb(cache, "Cache", "Redis", "Caches frequent data and handles event queues.", $sprite="redis")
    
    Container(blockchain, "Solana Blockchain", "Anchor Framework", "Executes smart contracts for Energy Token, Governance, Oracle, Registry, and Trading.", $sprite="coins")
}

Rel(user, frontend, "Views dashboard, trades energy", "HTTPS")
Rel(frontend, gateway, "Fetches data, performs auth", "JSON/HTTPS")
Rel(frontend, blockchain, "Signs transactions, queries state", "RPC/WSS")
Rel(simulator, gateway, "Submits energy readings", "JSON/HTTPS")

Rel(gateway, db, "Reads/Writes data", "SQL/TCP")
Rel(gateway, cache, "Reads/Writes cache", "RESP/TCP")
Rel(gateway, blockchain, "Submits oracle data, monitors events", "RPC/WSS")

@enduml
