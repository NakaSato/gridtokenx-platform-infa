@startuml
!include <C4/C4_Container>
!include <tupadr3/font-awesome-5/coins>
!include <tupadr3/font-awesome-5/link>
!include <tupadr3/font-awesome-5/user_shield>
!include <tupadr3/font-awesome-5/project_diagram>
!include <tupadr3/font-awesome-5/broadcast_tower>



title **Blockchain Layer - Decentralized Infrastructure**\nProgram Interoperability & State Management Flow

' Layout Control
LAYOUT_TOP_DOWN()

System_Boundary(off_chain, "Integration & Signing Layer") {
    Container(api_gateway, "API Gateway", "Rust Backend", "Trusted platform signer for oracle updates and system overrides.", $sprite="user_shield")
    Container(trading_app, "Trading App", "Next.js / TypeScript", "User-facing client for wallet connection and trade approvals.")
}

System_Ext(pyth, "Pyth Network Oracles", "External price feeds for cross-currency energy valuation.", $sprite="broadcast_tower")

System_Boundary(on_chain, "Solana L1 Core (Consensus Layer)") {
    Container(solana_cluster, "Solana Validator Cluster", "Validator Nodes", "Global state persistence and low-latency transaction processing.", $sprite="link")
    
    System_Boundary(gtx_programs, "GridTokenX Logic Suite (Anchor)") {
        Container(registry, "Registry Program", "PDA Management", "Digital identities and deterministic address resolution.")
        Container(trading, "Trading Program", "Market Escrow", "Atomic matching engine constraints and P2P settlement.")
    }
    
    Container(spl_token, "SPL Token Program", "Token-2022", "Standard for minting, burning, and transferring GXT/USDC.", $sprite="coins")
}

' External Dependencies
Rel_R(pyth, solana_cluster, "On-Chain Feeds", "Oracle Protocol")

' Interactions
Rel_D(api_gateway, solana_cluster, "Orchestration", "JSON RPC")
Rel_D(trading_app, solana_cluster, "User Actions", "JSON RPC / WSS")

' On-Chain Program Interactions
Rel_D(solana_cluster, registry, "State Resolution", "PDA Seeds")
Rel_D(solana_cluster, trading, "Market Operations", "Instruction Data")

Rel_Neighbor(registry, trading, "Authorize", "CPI Validation")
Rel_L(trading, spl_token, "Transfer Energy/USDC", "Atomic CPI")

' Layout hints
Rel_Neighbor(registry, trading, " ", " ") #hidden

' Key Technical Notes
note top of registry
  **PDAs (Program Derived Addresses):**
  Uses deterministic seeds to link 
  Database IDs to Blockchain accounts 
  without storing private keys.
end note

note top of trading
  **Trustless Escrow:**
  Funds are held by the program 
  authority until specific market 
  conditions are met.
end note

footer GridTokenX Blockchain Sovereignty | 2026
@enduml
