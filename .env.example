# =========================================================================
# GridTokenX P2P Energy Trading Platform - API Gateway
# Unified Environment Configuration
# =========================================================================
# This file consolidates environment variables from:
# - .env (current local configuration)
# - .env.example (template with documentation)
# - .env.global (global platform configuration)
#
# Latest Update: November 28, 2025

# =========================================================================
# APPLICATION CONFIGURATION
# =========================================================================
ENVIRONMENT=development
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
PORT=8080  # Legacy support
API_PORT=8080  # Alternative name
API_BASE_URL=http://localhost:8080
RUST_LOG=info
LOG_LEVEL=info  # Legacy support
NODE_ENV=development
TEST_MODE=true
LOG_FORMAT=json
AUDIT_LOG_ENABLED=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=60

# =========================================================================
# DATABASE CONFIGURATION
# =========================================================================
# PostgreSQL (Main Application Database)
DATABASE_URL=postgresql://gridtokenx_user:gridtokenx_password@localhost:5432/gridtokenx
POSTGRES_DB=gridtokenx
POSTGRES_USER=gridtokenx_user
POSTGRES_PASSWORD=gridtokenx_password
DATABASE_MAX_CONNECTIONS=50
DATABASE_MIN_CONNECTIONS=5
MAX_CONNECTIONS=50  # Legacy support

# Test Database
TEST_DATABASE_URL=postgresql://test_user:test_password@localhost:5432/gridtokenx_test

# =========================================================================
# REDIS CONFIGURATION
# =========================================================================
REDIS_URL=redis://localhost:6379
REDIS_PORT=6379
REDIS_MAX_CONNECTIONS=20
REDIS_POOL_SIZE=20  # Legacy support
REDIS_CONNECTION_TIMEOUT=5
REDIS_COMMAND_TIMEOUT=3
TEST_REDIS_URL=redis://localhost:6379/1
REQUEST_TIMEOUT=30

# =========================================================================
# INFLUXDB CONFIGURATION
# =========================================================================
INFLUXDB_URL=http://localhost:8086
INFLUXDB_TOKEN=your-influxdb-token
INFLUXDB_ORG=gridtokenx
INFLUXDB_BUCKET=energy_readings
TEST_INFLUXDB_URL=http://localhost:8086
TEST_INFLUXDB_TOKEN=test-influxdb-token
TEST_INFLUXDB_ORG=gridtokenx
TEST_INFLUXDB_BUCKET=energy_readings_test

# =========================================================================
# SOLANA BLOCKCHAIN CONFIGURATION
# =========================================================================
SOLANA_RPC_URL=http://localhost:8899
SOLANA_WS_URL=ws://localhost:8900
SOLANA_CLUSTER=localnet

# Alternative configurations (commented out)
# For devnet:
# SOLANA_RPC_URL=https://api.devnet.solana.com
# SOLANA_WS_URL=wss://api.devnet.solana.com

# For mainnet-beta (production):
# SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
# SOLANA_WS_URL=wss://api.mainnet-beta.solana.com

# Program IDs (Auto-generated from anchor build)
REGISTRY_PROGRAM_ID=FSXdxk5uPUvJc51MzjtBaCDrFh7RSMcHFHKpzCG9LeuJ
ENERGY_TOKEN_PROGRAM_ID=FaELH72fUMRaLTX3ersmQLr4purfHGvJccm1BXfDPL6r
TRADING_PROGRAM_ID=CEWpf4Rvm3SU2zQgwsQpi5EMYBUrWbKLcAhAT2ouVoWD
ORACLE_PROGRAM_ID=G365L8A4Y3xmp5aN2GGLj2SJr5KetgE5F57PaFvCgSgG
GOVERNANCE_PROGRAM_ID=EAcyEzfXXJCDnjZKUrgHsBEEHmnozZJXKs2wdW3xnWgb

# Energy Token Configuration
ENERGY_TOKEN_MINT=9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM

# Key Paths
ENGINEERING_KEYPAIR_PATH=./validator-keys/engineering-keypair.json
ORACLE_KEYPAIR_PATH=./validator-keys/oracle-keypair.json
ENGINEERING_DEPT_KEYPAIR_PATH=./validator-keys/engineering-department-authority.json

# =========================================================================
# AUTHENTICATION & SECURITY
# =========================================================================
# JWT Configuration
JWT_SECRET=dev-jwt-secret-key-minimum-32-characters-long-for-development-2025
JWT_EXPIRATION=86400  # 24 hours

# API Keys
API_KEY_SECRET=test-api-key-secret-for-development-and-testing
ENGINEERING_API_KEY=engineering-department-api-key-2025
HMAC_SECRET=hmac-signature-secret-change-in-production

# Password Requirements
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL_CHARS=true

# Security Settings
SECURE_COOKIES=false  # Set to true for production
SESSION_TIMEOUT=3600  # 1 hour in seconds
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900  # 15 minutes in seconds

# =========================================================================
# EMAIL CONFIGURATION
# =========================================================================
# SMTP Configuration (MailHog for development)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USERNAME=
SMTP_PASSWORD=

# Production SMTP (Gmail example - commented out)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=your-email@gmail.com
# SMTP_PASSWORD=your-app-password

# Email sender details
EMAIL_FROM_NAME="GridTokenX"
EMAIL_FROM_ADDRESS=noreply@gridtokenx.com
SMTP_FROM=noreply@gridtokenx.com

# Email verification settings
EMAIL_VERIFICATION_ENABLED=true
EMAIL_VERIFICATION_REQUIRED=false  # Disabled for integration testing
EMAIL_VERIFICATION_EXPIRY_HOURS=24
EMAIL_VERIFICATION_BASE_URL=http://localhost:3000
EMAIL_AUTO_LOGIN_AFTER_VERIFICATION=true
ENABLE_EMAIL_VERIFICATION=true  # Feature flag
ENABLE_EMAIL_NOTIFICATIONS=true

# =========================================================================
# CORS CONFIGURATION
# =========================================================================
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8080
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=*
CORS_EXPOSE_HEADERS=*
CORS_MAX_AGE=3600

# =========================================================================
# RATE LIMITING
# =========================================================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW=60  # seconds
RATE_LIMIT_AUTH_REQUESTS=10
RATE_LIMIT_AUTH_WINDOW=60
RATE_LIMIT_TRADING_REQUESTS=20
RATE_LIMIT_TRADING_WINDOW=60

# =========================================================================
# MONITORING & OBSERVABILITY
# =========================================================================
ENABLE_METRICS=true
ENABLE_TRACING=true
PROMETHEUS_METRICS_ENABLED=true
GRAFANA_ADMIN_PASSWORD=admin

# Datadog Configuration
DD_API_KEY=0b2a4ba085738cb4198fcc25a61c4129
DD_SITE=us5.datadoghq.com

# Sentry Integration (commented out - add DSN for production)
# SENTRY_DSN=your_sentry_dsn

# =========================================================================
# FEATURE FLAGS
# =========================================================================
ENABLE_WEBSOCKET=true
ENABLE_BLOCKCHAIN_INTEGRATION=true
ENABLE_PUSH_NOTIFICATIONS=false
ENABLE_SMS_NOTIFICATIONS=false
ENABLE_MARKET_DYNAMICS=true

# =========================================================================
# CACHE CONFIGURATION
# =========================================================================
CACHE_TTL_DEFAULT=3600  # 1 hour
CACHE_TTL_USER_SESSION=86400  # 24 hours
CACHE_TTL_MARKET_DATA=300  # 5 minutes
CACHE_TTL_ANALYTICS=1800  # 30 minutes

# =========================================================================
# KAFKA CONFIGURATION (Optional)
# =========================================================================
# Kafka Settings (commented out as not currently used)
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_BROKER_ID=1
KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
KAFKA_INTER_BROKER_LISTENER_NAME=PLAINTEXT
KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR=1
KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS=0
ZOOKEEPER_CLIENT_PORT=2181
ZOOKEEPER_TICK_TIME=2000

# =========================================================================
# SMART METER CONFIGURATION
# =========================================================================
# Simulator Configuration
SMART_METER_SIMULATOR_PATH=./docker/smart-meter-simulator
SMART_METER_DATA_OUTPUT=./docker/smart-meter-simulator/data/meter_readings.jsonl
SIMULATION_INTERVAL=15
NUM_METERS=20
OUTPUT_FILE=./data/meter_readings.jsonl
SIMULATION_SPEED_MULTIPLIER=1.0

# Energy Configuration
SOLAR_PANEL_EFFICIENCY_MIN=0.85
SOLAR_PANEL_EFFICIENCY_MAX=0.95
BASE_GENERATION_MIN=3.0
BASE_GENERATION_MAX=15.0
BASE_CONSUMPTION_MIN=1.5
BASE_CONSUMPTION_MAX=8.0
NOISE_FACTOR_MIN=0.05
NOISE_FACTOR_MAX=0.15

# P2P Trading Configuration
MIN_SELL_PRICE=0.15
MAX_SELL_PRICE=0.35
MIN_BUY_PRICE=0.20
MAX_BUY_PRICE=0.40
GRID_FEED_IN_RATE=0.12
GRID_PURCHASE_RATE=0.28

# Weather Simulation
WEATHER_SUNNY_WEIGHT=0.4
WEATHER_PARTLY_CLOUDY_WEIGHT=0.3
WEATHER_CLOUDY_WEIGHT=0.15
WEATHER_OVERCAST_WEIGHT=0.1
WEATHER_RAINY_WEIGHT=0.05
WEATHER_CHANGE_FREQUENCY=5
RANDOM_SEED=42

# Battery Storage Configuration
BATTERY_CAPACITY_MIN=10.0
BATTERY_CAPACITY_MAX=30.0
BATTERY_EFFICIENCY_MIN=0.90
BATTERY_EFFICIENCY_MAX=0.95

# Meter Type Distribution
SOLAR_PROSUMER_RATIO=0.40
GRID_CONSUMER_RATIO=0.35
HYBRID_PROSUMER_RATIO=0.20
BATTERY_STORAGE_RATIO=0.05

# =========================================================================
# DOCKER PORT CONFIGURATION
# =========================================================================
APIGATEWAY_PORT=8080
EXPLORER_PORT=3000
TRADING_PORT=3001
WEBSITE_PORT=3002
SMARTMETER_PORT=8000
MAILPIT_SMTP_PORT=1025
MAILPIT_WEB_PORT=8025
ANCHOR_RPC_PORT=8899
ANCHOR_WS_PORT=8900

# Mailpit Configuration
MP_MAX_MESSAGES=5000
MP_DATABASE=/data/mailpit.db
MP_SMTP_AUTH_ACCEPT_ANY=1
MP_SMTP_AUTH_ALLOW_INSECURE=1
TZ=UTC

# =========================================================================
# TOKENIZATION CONFIGURATION
# =========================================================================
TOKENIZATION_KWH_TO_TOKEN_RATIO=1.0
TOKENIZATION_DECIMALS=9
TOKENIZATION_MAX_READING_KWH=100.0
TOKENIZATION_READING_MAX_AGE_DAYS=7
TOKENIZATION_AUTO_MINT_ENABLED=true
TOKENIZATION_POLLING_INTERVAL_SECS=60
TOKENIZATION_BATCH_SIZE=50
TOKENIZATION_MAX_RETRY_ATTEMPTS=3
TOKENIZATION_INITIAL_RETRY_DELAY_SECS=300
TOKENIZATION_RETRY_BACKOFF_MULTIPLIER=2.0
TOKENIZATION_MAX_RETRY_DELAY_SECS=3600
TOKENIZATION_MAX_TRANSACTIONS_PER_BATCH=20
TOKENIZATION_TRANSACTION_TIMEOUT_SECS=60

# =========================================================================
# ORACLE CONFIGURATION
# =========================================================================
PROCESSING_INTERVAL=900
ENGINEERING_AUTHORITY=true

# =========================================================================
# REC (RENEWABLE ENERGY CERTIFICATE) CONFIGURATION
# =========================================================================
REC_AUTHORITY_ONLY=true
REC_VALIDATOR_KEYPAIR_PATH=./validator-keys/rec-validator-keypair.json
REC_ISSUING_AUTHORITY=engineering-department
REC_CERTIFICATION_ENABLED=true
CARBON_OFFSET_RATE=0.7

# =========================================================================
# UNIVERSITY POA CONFIGURATION
# =========================================================================
UNIVERSITY_VALIDATOR_ENDPOINT=http://localhost:8899
ENGINEERING_DEPT_AUTHORITY=true

# =========================================================================
# WEBSOCKET CONFIGURATION
# =========================================================================
WS_ENABLED=true
WS_HOST=localhost
WS_PORT=8765

# =========================================================================
# FRONTEND CONFIGURATION
# =========================================================================
NEXT_PUBLIC_API_URL=http://localhost:8080
NEXT_PUBLIC_SOLANA_RPC_URL=https://api.devnet.solana.com
NEXT_PUBLIC_PYTH_PRICE_SERVICE_URL=https://hermes.pyth.network
VITE_SOLANA_RPC_URL=http://localhost:8898
VITE_SOLANA_WS_URL=ws://localhost:8901
VITE_API_BASE_URL=http://localhost:8080

# =========================================================================
# TEST CONFIGURATION
# =========================================================================
# JWT Configuration (for API tests)
TEST_JWT_SECRET=test_jwt_secret_key_for_testing_only
TEST_API_KEY_SECRET=test_api_key_secret_for_testing_only

# Test Data Configuration
ENABLE_TEST_DATA_GENERATION=true
TEST_USER_COUNT=10
TEST_OFFER_COUNT=50

# Playwright Configuration
PLAYWRIGHT_BASE_URL=http://localhost:5173
PLAYWRIGHT_HEADLESS=true
PLAYWRIGHT_TIMEOUT=30000

# Coverage Configuration
COVERAGE_THRESHOLD=80
COVERAGE_REPORTS=true

# =========================================================================
# FILE STORAGE (Optional)
# =========================================================================
# STORAGE_TYPE=local  # Options: local, s3, gcs
# AWS_REGION=us-east-1
# AWS_BUCKET=gridtokenx-storage
# AWS_ACCESS_KEY_ID=your_aws_access_key
# AWS_SECRET_ACCESS_KEY=your_aws_secret_key

# =========================================================================
# NOTIFICATION SETTINGS (Optional)
# =========================================================================
# Twilio (for SMS notifications)
# TWILIO_ACCOUNT_SID=your_twilio_account_sid
# TWILIO_AUTH_TOKEN=your_twilio_auth_token
# TWILIO_PHONE_NUMBER=+1234567890
