@startuml
!include <C4/C4_Container>
!include <tupadr3/font-awesome-5/user>
!include <tupadr3/font-awesome-5/wallet>
!include <tupadr3/font-awesome-5/server>
!include <tupadr3/font-awesome-5/link>
!include <tupadr3/font-awesome-5/sign>
!include <tupadr3/font-awesome-5/key>
!include <tupadr3/font-awesome-5/unlock>

title **User Web2/Web3 Connection Architecture**

' User Types
System_Boundary(users, "User Types") {
    Person(web2_user, "Web2 User", "Traditional user with email/password login", $sprite="user")
    Person(web3_user, "Web3 User", "Crypto-native user with self-custody wallet", $sprite="wallet")
    Person(hybrid_user, "Hybrid User", "Both Web2 account + Wallet linked", $sprite="link")
}

' Web2 Connection Path
System_Boundary(web2_boundary, "Web2 Connection Layer") {
    Container(web2_login, "Web2 Login", "Email/Password", "Traditional authentication flow", $sprite="unlock")
    Container(jwt_auth, "JWT Authentication", "Bearer Token", "24-hour session tokens", $sprite="key")
    Container(traditional_ui, "Web Dashboard", "Next.js / React", "Traditional trading interface", $sprite="server")
}

' Web3 Connection Path
System_Boundary(web3_boundary, "Web3 Connection Layer") {
    Container(wallet_connector, "Wallet Connector", "Phantom/Solflare", "Browser extension wallet", $sprite="wallet")
    Container(solana_rpc, "Solana RPC", "JSON RPC / WSS", "Direct blockchain access", $sprite="link")
    Container(web3_ui, "dApp Interface", "Next.js / Web3.js", "Blockchain-connected UI", $sprite="server")
    Container(tx_signer, "Transaction Signer", "Wallet Standard", "User-signed transactions", $sprite="sign")
}

' Unified Backend
System_Boundary(backend, "Unified Backend Services") {
    Container(api_gateway, "API Gateway", "Rust / Axum", "REST API & WebSocket gateway", $sprite="server")
    Container(auth_service, "Auth Service", "JWT + Wallet Verify", "Unified authentication", $sprite="key")
    ContainerDb(user_db, "User Database", "PostgreSQL", "Web2 accounts & wallet mappings", $sprite="server")
}

' Blockchain Layer
System_Boundary(blockchain, "Blockchain Layer (Solana)") {
    Container(solana_cluster, "Solana Network", "L1 Blockchain", "Smart contracts & token state", $sprite="link")
    Container(anchor_program, "Anchor Programs", "Rust / Solana", "Minting & Trading contracts", $sprite="server")
    Container(token_program, "SPL Token Program", "Solana Native", "Token management", $sprite="link")
}

' Web2 User Connections
Rel(web2_user, web2_login, "Authenticates", "Email/Password")
Rel(web2_login, jwt_auth, "Generates", "JWT Token")
Rel(web2_user, traditional_ui, "Accesses", "HTTPS")
Rel(traditional_ui, jwt_auth, "Includes", "Authorization Header")
Rel(jwt_auth, api_gateway, "Validates", "HTTP/1.1")

' Web3 User Connections
Rel(web3_user, wallet_connector, "Connects", "Browser Extension")
Rel(web3_user, web3_ui, "Interacts with", "HTTPS")
Rel(web3_ui, wallet_connector, "Requests", "Wallet Adapter API")
Rel(web3_ui, solana_rpc, "Reads state", "JSON RPC / WebSocket")
Rel(web3_ui, tx_signer, "Requests signature", "Wallet Standard")
Rel(tx_signer, solana_rpc, "Submits signed tx", "Solana JSON RPC")
Rel(solana_rpc, solana_cluster, "Propagates", "Solana Protocol")

' Hybrid User Connections
Rel(hybrid_user, web2_login, "Authenticates", "Email/Password")
Rel(hybrid_user, wallet_connector, "Links wallet", "Wallet Signature")
Rel(hybrid_user, traditional_ui, "Uses Web2 UI", "HTTPS + JWT")
Rel(hybrid_user, web3_ui, "Uses Web3 UI", "HTTPS + Wallet")

' Backend Connections
Rel(api_gateway, auth_service, "Validates", "Internal")
Rel(auth_service, user_db, "Queries", "SQL")
Rel(api_gateway, solana_cluster, "Submits transactions", "JSON RPC")

' Cross-layer Connections
Rel(traditional_ui, api_gateway, "API calls", "REST / WebSocket")
Rel(web3_ui, api_gateway, "Hybrid API calls", "REST + Wallet Auth")
Rel(api_gateway, anchor_program, "Invokes", "Anchor Framework")
Rel(anchor_program, token_program, "Manages tokens", "SPL Standard")

' Data Flow Notes
note right of web2_user
  **Web2 Flow:**
  1. Email/password login
  2. Receive JWT token
  3. Access API via token
  4. Platform manages wallet
end note

note right of web3_user
  **Web3 Flow:**
  1. Connect wallet
  2. Sign message to verify
  3. Self-custody of keys
  4. Direct blockchain access
end note

note bottom of hybrid_user
  **Hybrid Flow:**
  Web2 account with linked
  wallet for both custodial
  and self-custodial options
end note

footer GridTokenX v2.0 | User Web2/Web3 Connection Architecture | 2026
@enduml
