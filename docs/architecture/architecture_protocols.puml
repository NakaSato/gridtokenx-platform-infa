@startuml
!include <C4/C4_Container>
!include <tupadr3/devicons/react>
!include <tupadr3/devicons/python>
!include <tupadr3/devicons/rust>
!include <tupadr3/devicons/postgresql>
!include <tupadr3/devicons/redis>
!include <tupadr3/font-awesome-5/coins>
!include <tupadr3/font-awesome-5/user>
!include <tupadr3/font-awesome-5/server>
!include <tupadr3/font-awesome-5/bolt>
!include <tupadr3/font-awesome-5/envelope>

' Visual Configuration
skinparam defaultFontName "Helvetica Neue"
skinparam defaultFontSize 12
skinparam roundCorner 8
skinparam shadowing false
skinparam backgroundColor #FFFFFF

title **GridTokenX Comprehensive Architecture & Protocols**

Person(user, "User / Prosumer", "Energy producer/consumer managing smart meters and trading tokens.", $sprite="user")

System_Boundary(frontend_layer, "Frontend Layer") {
    Container(trading_app, "Trading App", "Next.js", "Core UI for energy trading, visualization, and wallet connection.", $sprite="react")
    Container(wallet, "Wallet Adapter", "Library", "Connector for browser wallet extensions.")
}

System_Boundary(backend_layer, "Service Layer") {
    Container(api_gateway, "API Gateway", "Rust / Axum", "Central orchestration and business logic handler.", $sprite="rust")
    Container(simulator, "Smart Meter Sim", "Python / FastAPI", "Generates real-time grid telemetry data.", $sprite="python")
}

System_Boundary(blockchain_boundary, "Web3 Layer (Solana)") {
    Container(solana_cluster, "Solana Cluster", "L1 Chain", "Decentralized consensus and on-chain state store.")
    Container(anchor_programs, "Anchor Programs", "Smart Contracts", "On-chain business logic (Registry, Trading, Minting).")
}

System_Boundary(data_boundary, "Data & Infrastructure") {
    ContainerDb(postgres, "PostgreSQL", "Relational DB", "User, Order, and configurations.", $sprite="postgresql")
    ContainerDb(redis, "Redis", "Cache / PubSub", "Real-time state and sessions.", $sprite="redis")
    ContainerDb(influx, "InfluxDB", "Time-Series", "Granular meter telemetry.", $sprite="bolt")
    ContainerQueue(kafka, "Kafka", "Message Queue", "High-throughput event streaming.", $sprite="server")
    Container(prometheus, "Prometheus", "Monitoring", "System performance metrics.")
}

System_Ext(pyth, "Pyth Network", "Oracle price feeds.")
System_Ext(mapbox, "Mapbox", "Geospatial mapping tiles.")
System_Ext(smtp, "Email Service", "Notifications.", $sprite="envelope")

' Protocol Flows
Rel(user, trading_app, "HTTPS / UX")
Rel(trading_app, api_gateway, "JSON API / WS", "HTTP 1.1/2, WebSocket")
Rel(trading_app, solana_cluster, "Read State / Sub", "JSON RPC, WSS")
Rel(trading_app, wallet, "Signatures", "Wallet Standard")
Rel(trading_app, pyth, "Price Feeds", "HTTP")
Rel(trading_app, mapbox, "GIS Tiles", "HTTPS (Vector Tiles)")

Rel(api_gateway, postgres, "Transact", "PostgreSQL Wire")
Rel(api_gateway, redis, "Cache/PubSub", "RESP")
Rel(api_gateway, solana_cluster, "Submit Tx", "JSON RPC")
Rel(api_gateway, kafka, "Consume Events", "Kafka Protocol")
Rel(api_gateway, smtp, "Send Alerts", "SMTP")
Rel(prometheus, api_gateway, "Scrape", "HTTP")

Rel(simulator, kafka, "Emit Readings", "Kafka Protocol")
Rel(simulator, influx, "Store Metrics", "Line Protocol")
Rel(simulator, postgres, "Persist Config", "SQL")
Rel(api_gateway, simulator, "Control", "HTTP (REST)")

footer GridTokenX v2.0 | Holistic System Protocols | 2026
@enduml
